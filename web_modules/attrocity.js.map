{"version":3,"file":"attrocity.js","sources":["../node_modules/attrocity/src/map.js","../node_modules/attrocity/src/reflect.js"],"sourcesContent":["export default class Map {\n    /**\n     * defaults\n     * @returns {{attribute: string, root: string}}\n     */\n    static get mapdefaults() {\n        return {\n            attribute: 'map',\n            root: 'maproot'\n        }\n    };\n\n    /**\n     * defaults\n     * @returns {{attribute: string, root: string}}\n     */\n    static get wiredefaults() {\n        return {\n            attribute: 'wire',\n            root: 'maproot'\n        }\n    };\n\n    /**\n     * generate attribute selector for query selection\n     * @param name\n     * @returns {string}\n     */\n    static _attributeSelector(name) { return '[' + name + ']'; };\n\n    /**\n     * map dom elements with desired attribute to object\n     * @param node\n     * @param startingObj\n     * @param opts\n     */\n    static map(node, startingObj, opts) {\n        opts = Object.assign(this.mapdefaults, opts ? opts : {} );\n        const selector = this._attributeSelector(opts.attribute);\n\n        let domcache = startingObj ? startingObj : {};\n        let els = node.querySelectorAll(selector);\n        let rootlevelEls = node.querySelectorAll(this._attributeSelector(opts.root));\n\n        els = this._filterElementsContainedByRoot(els, rootlevelEls);\n\n        for (let e = 0; e < els.length; e++) {\n            let path = els[e].getAttribute(opts.attribute).split('.');\n            const prop = path.pop();\n            const deepref = this._ensurePropertyPath(domcache, path);\n            this._setProperty(deepref, prop, els[e]);\n\n        }\n        return domcache;\n    };\n\n    static wire(node, callback, scope, opts) {\n        opts = Object.assign(this.wiredefaults, opts ? opts : {} );\n        const selector = this._attributeSelector(opts.attribute);\n        let els = node.querySelectorAll(selector);\n        let rootlevelEls = node.querySelectorAll(this._attributeSelector(opts.root));\n\n        els = this._filterElementsContainedByRoot(els, rootlevelEls);\n        for (let e = 0; e < els.length; e++) {\n            const eventtypes = els[e].getAttribute(opts.attribute).split(',');\n            for (let c = 0; c < eventtypes.length; c++) {\n                els[e].addEventListener(eventtypes[c], e => { callback.apply(scope, [e]) });\n            }\n        }\n    }\n\n    static wireElements(els, events, callback, scope) {\n        if (!Array.isArray(els)) {\n            els =  [els];\n        }\n        let eventtypes = events;\n        if (!Array.isArray(events)) {\n            eventtypes = eventtypes.split(',');\n        }\n        for (let d = 0; d < els.length; d++) {\n            for (let c = 0; c < eventtypes.length; c++) {\n                els[d].addEventListener(eventtypes[c].trim(), e => { callback.apply(scope, [e]) });\n            }\n        }\n    }\n\n    /**\n     * ensure deep or shallow path exists on object\n     * @param obj\n     * @param propslist\n     * @return deep reference\n     */\n    static _ensurePropertyPath(obj, propslist) {\n        propslist = propslist.reverse();\n        let parent;\n        let parentProp;\n        while (propslist.length > 0) {\n            const prop = propslist.pop();\n            if (!obj[prop]) {\n                obj[prop] = {};\n            }\n            parent = obj;\n            obj = obj[prop];\n            parentProp = prop;\n        }\n        return { current: obj, parent: parent, parentProp: parentProp };\n    }\n\n    /**\n     * set property on object\n     * @param obj\n     * @param prop\n     * @param val\n     * @private\n     */\n    static _setProperty(obj, prop, val) {\n        let ref = obj.current;\n        let parent = obj.parent;\n        let parentProp = obj.parentProp;\n        if (!ref[prop]) {\n            // element already set on prop, but we're adding more key/values to it as an object\n            // roll back to parent and set object that can hold all\n            if (ref instanceof Element) {\n                parent[parentProp] = {};\n                parent[parentProp][parentProp] = ref;\n                parent[parentProp][prop] = val;\n            } else {\n                ref[prop] = val;\n            }\n        } else if (ref[prop] instanceof Element) {\n            // element already exists on key, turn into array holding list\n            ref[prop] = [ ref[prop] ];\n            ref[prop].push(val);\n        } else if (Array.isArray(ref[prop])) {\n            ref[prop].push(val);\n        } else if (Object.keys(ref[prop]).length > 0) {\n            // key being set is already an object containing keys, bump this key further down the chain\n            ref[prop][prop] = val;\n        }\n    }\n\n    /**\n     * remove elements contained by marked roots\n     * @param els\n     * @param roots\n     * @returns {Array}\n     */\n    static _filterElementsContainedByRoot(els, roots) {\n        const nondeepEls = [];\n        for (let e = 0; e < els.length; e++) {\n            let elIsContainedByRoot = false;\n            for (let d = 0; d < roots.length; d++) {\n                if (roots[d] !== els[e] && roots[d].contains(els[e])) {\n                    elIsContainedByRoot = true;\n                }\n            }\n            if (!elIsContainedByRoot) {\n                nondeepEls.push(els[e]);\n            }\n        }\n        return nondeepEls;\n    }\n}\n","export default class Reflect {\n    static attach(clazz, changeCallbackFnName) {\n        if (!changeCallbackFnName) {\n            changeCallbackFnName = 'propertyChangedCallback';\n        }\n        const props = clazz.observedAttributes;\n        if (props) {\n            for (let c = 0; c < props.length; c++) {\n                Object.defineProperty(clazz.prototype, props[c], {\n                    set: function (val) {\n                        const old = this.getAttribute(props[c]);\n                        if (val === false) {\n                            this.removeAttribute(props[c]);\n                        } else {\n                            this.setAttribute(props[c], val);\n                        }\n                        if (this[changeCallbackFnName]) {\n                            this[changeCallbackFnName](props[c], old, val);\n                        }\n                    },\n\n                    get: function () {\n                        return this.getAttribute(props[c]);\n                    }\n                });\n            }\n\n            clazz.prototype.attributeChangedCallback = function(name, oldval, newval) {\n                if (this[changeCallbackFnName]) {\n                    this[changeCallbackFnName](name, oldval, newval);\n                }\n            }\n        } else {\n            console.warn( clazz.constructor, 'No attributes for reflection specified in the observedAttributes static getter')\n        }\n        return clazz;\n    }\n}\n"],"names":[],"mappings":"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"}